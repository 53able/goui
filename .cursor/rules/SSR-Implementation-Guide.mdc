# Hono + Vite SSR å®Ÿè£…ã‚¬ã‚¤ãƒ‰

> React 19 + Hono + Vite ã«ã‚ˆã‚‹æœ¬æ ¼çš„ãªSSRï¼ˆServer-Side Renderingï¼‰å®Ÿè£…ã®å®Œå…¨ã‚¬ã‚¤ãƒ‰

---

## ğŸ¯ ã“ã®ã‚¬ã‚¤ãƒ‰ã®ç›®çš„

ãƒ¢ãƒãƒ¬ãƒæ§‹æˆã®Reactã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã€ä»¥ä¸‹ã‚’å®Ÿç¾ã™ã‚‹SSRã‚’å®Ÿè£…ã™ã‚‹ï¼š

- **SSRï¼ˆã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼‰**: åˆå›ãƒ­ãƒ¼ãƒ‰é«˜é€ŸåŒ–ã€SEOå¯¾å¿œ
- **HMRï¼ˆãƒ›ãƒƒãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒªãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ¡ãƒ³ãƒˆï¼‰**: ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ã‚’å³åº§ã«åæ˜ 
- **Fast Refresh**: ReactçŠ¶æ…‹ã‚’ä¿æŒã—ãŸã¾ã¾æ›´æ–°
- **ãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã«

---

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ãƒ–ãƒ©ã‚¦ã‚¶ (Client)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚                   â”‚
        â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GET /        â”‚   â”‚ GET /src/*.tsxâ”‚   â”‚ WebSocket HMR â”‚
â”‚  (HTMLè¦æ±‚)    â”‚   â”‚ (JSè¦æ±‚)      â”‚   â”‚ (å¤‰æ›´é€šçŸ¥)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                   â”‚                   â”‚
        â–¼                   â”‚                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Hono SSR ã‚µãƒ¼ãƒãƒ¼ (:3002)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  vite.ssrLoadModule() ã§Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆèª­è¾¼   â”‚  â”‚
â”‚  â”‚  renderToString() ã§HTMLç”Ÿæˆ                    â”‚  â”‚
â”‚  â”‚  Viteã‚¢ã‚»ãƒƒãƒˆã¸ã®ãƒ—ãƒ­ã‚­ã‚·                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Vite Dev ã‚µãƒ¼ãƒãƒ¼ (:5175)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  TypeScript/JSXå¤‰æ›                             â”‚  â”‚
â”‚  â”‚  HMR WebSocketç®¡ç†                              â”‚  â”‚
â”‚  â”‚  React Fast Refresh                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ•ãƒ­ãƒ¼è©³ç´°

1. **åˆå›ã‚¢ã‚¯ã‚»ã‚¹** (`GET /`)
   - Hono SSRã‚µãƒ¼ãƒãƒ¼ãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡
   - `vite.ssrLoadModule`ã§Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ­ãƒ¼ãƒ‰
   - `renderToString`ã§HTMLã‚’ç”Ÿæˆ
   - åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’`window.__INITIAL_DATA__`ã«æ³¨å…¥
   - å®Œå…¨ãªHTMLã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«è¿”å´

2. **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´**
   - SSRã•ã‚ŒãŸHTMLã‚’å³åº§ã«è¡¨ç¤º
   - `main.tsx`ãŒãƒ­ãƒ¼ãƒ‰ã•ã‚Œ`hydrateRoot`ã‚’å®Ÿè¡Œ
   - ReactãŒãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§æ¥ç¶š
   - å®Œå…¨ã«ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¢ãƒ—ãƒªã«

3. **HMRï¼ˆé–‹ç™ºæ™‚ï¼‰**
   - Vite dev serverãŒãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ã‚’æ¤œçŸ¥
   - WebSocketçµŒç”±ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€šçŸ¥
   - React Fast Refreshã§çŠ¶æ…‹ã‚’ä¿æŒã—ãŸã¾ã¾æ›´æ–°

---

## ğŸ“ å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
apps/{app-name}/
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ dev.ts          # é–‹ç™ºç”¨SSRã‚µãƒ¼ãƒãƒ¼ï¼ˆViteçµ±åˆï¼‰
â”‚   â”œâ”€â”€ production.ts   # æœ¬ç•ªç”¨ã‚µãƒ¼ãƒãƒ¼
â”‚   â””â”€â”€ app.ts          # APIãƒ«ãƒ¼ãƒˆå®šç¾©
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.tsx        # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¨ãƒ³ãƒˆãƒªãƒ¼ï¼ˆãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
â”‚   â”œâ”€â”€ App.tsx         # ãƒ«ãƒ¼ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â””â”€â”€ ...
â”œâ”€â”€ vite.config.ts      # SSRè¨­å®šã‚’å«ã‚€Viteè¨­å®š
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

---

## ğŸ”§ å®Ÿè£…æ‰‹é †

### Step 1: vite.config.ts ã«SSRè¨­å®šã‚’è¿½åŠ 

```typescript
import { resolve } from 'node:path';
import tailwindcss from '@tailwindcss/vite';
import react from '@vitejs/plugin-react';
import { defineConfig } from 'vite';

export default defineConfig({
  plugins: [
    react({
      jsxRuntime: 'automatic',
      include: /\.(tsx?|jsx?)$/,
      exclude: /node_modules/,
    }),
    tailwindcss(),
  ],
  resolve: {
    alias: {
      '@': resolve(import.meta.dirname, './src'),
    },
  },
  server: {
    port: 5175, // ã‚¢ãƒ—ãƒªã”ã¨ã«å¤‰æ›´
    proxy: {
      '/api': {
        target: 'http://localhost:3002', // APIã‚µãƒ¼ãƒãƒ¼ãƒãƒ¼ãƒˆ
        changeOrigin: true,
      },
    },
  },
  // â¬‡ï¸ SSRè¨­å®šï¼ˆé‡è¦ï¼ï¼‰
  ssr: {
    // react ã¨ react-dom ã¯Node.jsãƒã‚¤ãƒ†ã‚£ãƒ–ã§å‡¦ç†ï¼ˆCommonJSäº’æ›ï¼‰
    external: ['react', 'react-dom'],
  },
  build: {
    manifest: true,
    ssrManifest: true,
    outDir: 'dist',
  },
});
```

### Step 2: server/dev.ts ã‚’å®Ÿè£…

```typescript
import { serve } from '@hono/node-server';
import { OpenAPIHono } from '@hono/zod-openapi';
import { basicAuth } from 'hono/basic-auth';
import { createElement, StrictMode } from 'react';
import { renderToString } from 'react-dom/server';
import { createServer as createViteServer, type ViteDevServer } from 'vite';
import { apiRoutes } from './app.js';

// ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªViteã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
let vite: ViteDevServer;

/**
 * Viteã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
 */
const createVite = async () => {
  vite = await createViteServer({
    server: {
      middlewareMode: false,
      port: 5175, // ã‚¢ãƒ—ãƒªã”ã¨ã«å¤‰æ›´
      hmr: { port: 5175 },
    },
    appType: 'custom',
  });
  await vite.listen();
  return vite;
};

/**
 * é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
 */
const startDevServer = async () => {
  const port = Number(process.env.API_PORT) || 3002;

  // Vite dev serverã‚’èµ·å‹•
  console.log('ğŸ”§ Starting Vite dev server...');
  await createVite();
  console.log('âœ… Vite dev server ready');

  // Honoã‚¢ãƒ—ãƒªã‚’ä½œæˆ
  const app = new OpenAPIHono();

  // APIèªè¨¼ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
  app.use(
    '/api/v1/*',
    basicAuth({
      username: process.env.BASIC_AUTH_USERNAME ?? 'admin',
      password: process.env.BASIC_AUTH_PASSWORD ?? 'admin',
    }),
  );

  // APIãƒ«ãƒ¼ãƒˆã‚’ãƒã‚¦ãƒ³ãƒˆ
  app.route('/api', apiRoutes);

  // Viteé–¢é€£ã‚¢ã‚»ãƒƒãƒˆã‚’ãƒ—ãƒ­ã‚­ã‚·
  const VITE_PROXY_PATHS = [
    '/src/*',
    '/@vite/*',
    '/@fs/*',
    '/@id/*',
    '/@react-refresh',
    '/node_modules/*',
  ];

  for (const path of VITE_PROXY_PATHS) {
    app.use(path, async (c) => {
      const url = new URL(c.req.url);
      const viteUrl = `http://localhost:5175${url.pathname}${url.search}`;
      const res = await fetch(viteUrl);
      return new Response(res.body, {
        status: res.status,
        headers: res.headers,
      });
    });
  }

  // React SSRã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
  app.get('*', async (c) => {
    try {
      // åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
      const initialData = {
        title: 'App Title',
        description: 'App Description',
        timestamp: new Date().toISOString(),
      };

      // Viteã§Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ­ãƒ¼ãƒ‰
      const { App } = await vite.ssrLoadModule('/src/App.tsx');

      // Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’SSR
      const appHtml = renderToString(
        createElement(StrictMode, {}, createElement(App, { initialData })),
      );

      // HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
      const template = `<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${initialData.title}</title>
  <meta name="description" content="${initialData.description}">
  <script>window.__INITIAL_DATA__ = ${JSON.stringify(initialData)};</script>
</head>
<body>
  <div id="root">${appHtml}</div>
  <script type="module" src="http://localhost:5175/src/main.tsx"></script>
  <script type="module">
    import RefreshRuntime from 'http://localhost:5175/@react-refresh'
    RefreshRuntime.injectIntoGlobalHook(window)
    window.$RefreshReg$ = () => {}
    window.$RefreshSig$ = () => (type) => type
    window.__vite_plugin_react_preamble_installed__ = true
  </script>
</body>
</html>`;

      // Viteã®HTMLå¤‰æ›ã‚’é©ç”¨
      const html = await vite.transformIndexHtml(c.req.url, template);
      return c.html(html);
    } catch (error) {
      if (error instanceof Error) {
        vite.ssrFixStacktrace(error);
        console.error('âŒ SSR Error:', error.message);
      }
      // ã‚¨ãƒ©ãƒ¼æ™‚ã¯CSRã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
      return c.html(`<html><body><div id="root"></div>
        <script type="module" src="http://localhost:5175/src/main.tsx"></script>
      </body></html>`, 500);
    }
  });

  serve({ fetch: app.fetch, port });
};

startDevServer();
```

### Step 3: src/main.tsx ã‚’å®Ÿè£…ï¼ˆãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œï¼‰

```typescript
import { StrictMode } from 'react';
import { createRoot, hydrateRoot } from 'react-dom/client';
import { App } from './App';
import './index.css';

/**
 * ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰æ³¨å…¥ã•ã‚ŒãŸåˆæœŸãƒ‡ãƒ¼ã‚¿ã®å‹å®šç¾©
 */
interface InitialData {
  title: string;
  description: string;
  timestamp: string;
}

declare global {
  interface Window {
    __INITIAL_DATA__?: InitialData;
  }
}

const rootElement = document.getElementById('root');
if (!rootElement) {
  throw new Error('Root element not found');
}

// ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰æ³¨å…¥ã•ã‚ŒãŸåˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
const initialData = window.__INITIAL_DATA__ || {
  title: 'Default Title',
  description: 'Default Description',
  timestamp: new Date().toISOString(),
};

const appElement = (
  <StrictMode>
    <App initialData={initialData} />
  </StrictMode>
);

// SSRã•ã‚ŒãŸHTMLãŒã‚ã‚‹å ´åˆã¯ãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
if (rootElement.hasChildNodes()) {
  console.log('ğŸ”„ Hydrating React app...');
  try {
    hydrateRoot(rootElement, appElement);
    console.log('âœ… Hydration successful!');
  } catch (error) {
    console.error('âŒ Hydration failed:', error);
    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
    rootElement.innerHTML = '';
    createRoot(rootElement).render(appElement);
  }
} else {
  console.log('âš¡ Rendering React app...');
  createRoot(rootElement).render(appElement);
}
```

### Step 4: src/App.tsx ã§åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹

```typescript
import type { FC } from 'react';

interface AppProps {
  initialData?: {
    title: string;
    description: string;
    timestamp: string;
  };
}

export const App: FC<AppProps> = ({ initialData }) => {
  return (
    <div>
      <h1>{initialData?.title || 'My App'}</h1>
      <p>Rendered at: {initialData?.timestamp}</p>
      {/* ã‚¢ãƒ—ãƒªã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
    </div>
  );
};
```

### Step 5: server/app.ts ã‚’ç°¡ç´ åŒ–ï¼ˆAPIãƒ«ãƒ¼ãƒˆã®ã¿ï¼‰

```typescript
import { OpenAPIHono } from '@hono/zod-openapi';
import { healthRoutes } from './routes/health.js';

const app = new OpenAPIHono();

// ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢è¨­å®š
// ...

// APIãƒ«ãƒ¼ãƒˆã®ã¿ç™»éŒ²
app.route('/api', healthRoutes);

// ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
// ...

// APIãƒ«ãƒ¼ãƒˆã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
export const apiRoutes = healthRoutes;
export { app };
```

### Step 6: packages/ui ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«Reactã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

SSRç’°å¢ƒã§ã¯ã€JSXã‚’ä½¿ç”¨ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã§æ˜ç¤ºçš„ã«Reactã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼š

```typescript
// packages/ui/src/Button.tsx
// biome-ignore lint/correctness/noUnusedImports: SSRã§JSXã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã«å¿…è¦
import React, { type ButtonHTMLAttributes, type FC } from 'react';

// ... ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…
```

---

## ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼: `@vitejs/plugin-react can't detect preamble`

**åŸå› **: Viteã®Reactãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒFast Refreshç”¨ã®preambleã‚’æ¤œå‡ºã§ããªã„

**è§£æ±ºç­–**:
1. `vite.config.ts`ã§`include`ã¨`exclude`ã‚’è¨­å®š
2. HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«preambleã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¿½åŠ ï¼š
```html
<script type="module">
  import RefreshRuntime from 'http://localhost:5175/@react-refresh'
  RefreshRuntime.injectIntoGlobalHook(window)
  window.$RefreshReg$ = () => {}
  window.$RefreshSig$ = () => (type) => type
  window.__vite_plugin_react_preamble_installed__ = true
</script>
```

### ã‚¨ãƒ©ãƒ¼: `require is not defined`

**åŸå› **: `react-dom/server`ã‚’Viteã®`ssrLoadModule`ã§èª­ã¿è¾¼ã‚‚ã†ã¨ã—ã¦ã„ã‚‹

**è§£æ±ºç­–**:
1. `vite.config.ts`ã§`ssr.external`ã‚’è¨­å®šï¼š
```typescript
ssr: {
  external: ['react', 'react-dom'],
}
```
2. `dev.ts`ã§`react`ã¨`react-dom`ã‚’ç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

### ã‚¨ãƒ©ãƒ¼: `React is not defined` (SSRæ™‚)

**åŸå› **: JSXãƒ•ã‚¡ã‚¤ãƒ«ã§ReactãŒã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å‚ç…§ã•ã‚Œã¦ã„ã‚‹

**è§£æ±ºç­–**: å…±æœ‰UIãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å†…ã®JSXãƒ•ã‚¡ã‚¤ãƒ«ã§æ˜ç¤ºçš„ã«Reactã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

### ãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä¸ä¸€è‡´

**åŸå› **: ã‚µãƒ¼ãƒãƒ¼ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°çµæœãŒç•°ãªã‚‹

**è§£æ±ºç­–**:
1. ä¸¡æ–¹ã§åŒã˜`StrictMode`è¨­å®šã‚’ä½¿ç”¨
2. åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’`window.__INITIAL_DATA__`çµŒç”±ã§ä¸€è‡´ã•ã›ã‚‹
3. æ—¥ä»˜ãªã©å‹•çš„ãªå€¤ã¯ã‚µãƒ¼ãƒãƒ¼ã§ç”Ÿæˆã—ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«æ¸¡ã™

---

## ğŸ“Š ãƒãƒ¼ãƒˆç•ªå·ã®å‰²ã‚Šå½“ã¦

| ã‚¢ãƒ—ãƒª | SSRã‚µãƒ¼ãƒãƒ¼ | Vite Dev |
|-------|-----------|----------|
| web | 3000 | 5173 |
| admin | 3001 | 5174 |
| playground | 3002 | 5175 |
| æ–°ã‚¢ãƒ—ãƒª | 3003ã€œ | 5176ã€œ |

---

## âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

SSRã‚’å®Ÿè£…ã™ã‚‹éš›ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼š

- [ ] `vite.config.ts`ã«`ssr.external`è¨­å®šã‚’è¿½åŠ 
- [ ] `server/dev.ts`ã§Viteçµ±åˆSSRã‚µãƒ¼ãƒãƒ¼ã‚’å®Ÿè£…
- [ ] `src/main.tsx`ã§ãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œ
- [ ] `src/App.tsx`ã§`initialData`ãƒ—ãƒ­ãƒƒãƒ—ã‚¹ã‚’å—ã‘å–ã‚‹
- [ ] å…±æœ‰UIãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§æ˜ç¤ºçš„ã«Reactã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
- [ ] HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«preambleã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¿½åŠ 
- [ ] `window.__INITIAL_DATA__`ã§åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’æ³¨å…¥
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã§CSRãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å®Ÿè£…

---

## ğŸš€ èµ·å‹•ã‚³ãƒãƒ³ãƒ‰

```bash
# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•ï¼ˆSSR + HMRï¼‰
pnpm --filter @goui/{app-name} dev:api
```

---

## ğŸ“š å‚è€ƒãƒªãƒ³ã‚¯

- [Vite SSR Guide](https://vite.dev/guide/ssr.html)
- [React 19 Server APIs](https://react.dev/reference/react-dom/server)
- [Hono Documentation](https://hono.dev/)
